<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Advanced Arrhythmia Module for PGY-1</title>
  <style>
    /* Base styles and transitions */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
      transition: background-color 0.3s, color 0.3s;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 20px;
      border-bottom: 1px solid #ccc;
    }
    nav a {
      margin-right: 15px;
      text-decoration: none;
      font-weight: bold;
      cursor: pointer;
    }
    .section {
      display: none;
      margin-top: 20px;
    }
    .active {
      display: block;
    }
    .diagram, .algo-diagram {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px 0;
      text-align: center;
    }
    button {
      padding: 6px 10px;
      margin: 5px;
      cursor: pointer;
    }
    .mcq, .algo-branch, .chadsvasc-box {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #f9f9f9;
    }
    /* Light and Dark Theme */
    .light-theme {
      background-color: #fff;
      color: #000;
    }
    .light-theme a {
      color: #0066cc;
    }
    .dark-theme {
      background-color: #222;
      color: #f0f0f0;
    }
    .dark-theme a {
      color: #99ccff;
    }
    /* Navigation bar */
    #navbar {
      margin-bottom: 20px;
    }
    input[type="number"] {
      width: 60px;
    }
  </style>
</head>
<body class="light-theme">
  <!-- Header with Navigation and Theme Toggle -->
  <header>
    <h1>Advanced Arrhythmia Module for PGY-1</h1>
    <div>
      <button id="themeToggle">Toggle Dark/Light Theme</button>
    </div>
  </header>
  <nav id="navbar">
    <a data-target="handoutSection">Handout</a>
    <a data-target="ecgSection">ECG Examples</a>
    <a data-target="mcqSection">Interactive MCQs</a>
    <a data-target="algoSection">Interactive Algorithm</a>
    <a data-target="chadsvascSection">CHADSVASC Calculator</a>
    <a data-target="refSection">References</a>
  </nav>

  <!-- SECTION: Handout (Advanced Details) -->
  <section id="handoutSection" class="section active">
    <h2>Advanced Arrhythmia Handout</h2>
    <p>
      Arrhythmia describes any deviation from normal cardiac rhythm or rate. In this module, we review advanced details pertinent to clinical decision‐making:
    </p>
    <h3>Normal Cardiac Conduction</h3>
    <p>
      The electrical conduction system comprises the <strong>Sinoatrial (SA) Node</strong> – the natural pacemaker; the <strong>Atrioventricular (AV) Node</strong> – which delays impulses to allow complete atrial contraction; and the <strong>His-Purkinje network</strong>, ensuring rapid impulse transmission through the ventricles. Knowledge of these pathways is critical when evaluating conduction disturbances.
    </p>
    <div class="diagram">
      <svg width="300" height="150">
        <circle cx="50" cy="75" r="20" fill="#2a5d84" />
        <text x="50" y="80" font-size="12" text-anchor="middle" fill="#fff">SA Node</text>
        <line x1="70" y1="75" x2="130" y2="75" stroke="#000" stroke-width="2"/>
        <circle cx="150" cy="75" r="20" fill="#2a5d84" />
        <text x="150" y="80" font-size="12" text-anchor="middle" fill="#fff">AV Node</text>
        <line x1="170" y1="75" x2="250" y2="75" stroke="#000" stroke-width="2"/>
        <text x="250" y="80" font-size="12" text-anchor="middle" fill="#2a5d84">His-Purkinje</text>
      </svg>
      <p>Figure: Normal Cardiac Conduction Network</p>
    </div>

    <h3>Bradyarrhythmias</h3>
    <p>
      <strong>Sinus Bradycardia:</strong> Although a slow rate (<60 bpm) may be normal in athletes, pathologic sinus bradycardia signifies intrinsic sinus node dysfunction (e.g., sick sinus syndrome) or secondary effects of medications (e.g., beta blockers, digoxin). Advanced evaluation includes assessing autonomic tone, ischemia, or infiltrative disease. Management involves stopping culpable medications, and in symptomatic cases, temporary or permanent pacing can be indicated.
    </p>
    <p>
      <strong>Heart Blocks:</strong>
      <br>• <em>First-Degree AV Block:</em> Reveals a prolonged PR interval (>200 ms) but is typically benign; however, it may herald progressive conduction system disease.
      <br>• <em>Second-Degree AV Block:</em> Distinguish <strong>Mobitz I (Wenckebach)</strong>—characterized by gradual PR lengthening ending in a dropped beat (usually vagally mediated)—from <strong>Mobitz II</strong>, where sudden non-conduction without preceding PR changes implies a high risk of progression to complete block.
      <br>• <em>Third-Degree AV Block:</em> Signals complete AV dissociation. Evaluation with echocardiography and electrophysiology studies may be required; treatment with pacemaker implantation is usually necessary.
    </p>
    
    <h3>Tachyarrhythmias</h3>
    <p>
      <strong>Supraventricular Tachycardia (SVT):</strong> This category includes AV nodal reentrant tachycardia (AVNRT), atrioventricular reentrant tachycardia (AVRT), and atrial tachycardia. Advanced ECM and invasive EP studies can delineate the reentrant circuits; first‐line treatment may involve vagal maneuvers then adenosine for acute termination.
    </p>
    <p>
      <strong>Atrial Fibrillation (AFib):</strong> AFib is the most common sustained arrhythmia and involves complex triggers such as focal firing (often from the pulmonary veins), structural remodeling, fibrosis, and inflammation. The subtypes include:
      <ul>
        <li><strong>Paroxysmal:</strong> Self-terminating within 7 days.</li>
        <li><strong>Persistent:</strong> Lasts >7 days or requires pharmacologic/electrical intervention.</li>
        <li><strong>Permanent:</strong> Longstanding where rate/rhythm control are accepted.</li>
        <li><strong>AFib with Rapid Ventricular Response (RVR):</strong> May cause hemodynamic compromise.</li>
        <li><strong>AFib with Controlled Rate:</strong> Ventricular rate is regulated with drugs.</li>
      </ul>
      <br>
      Decisions regarding rate or rhythm control depend on symptom burden and the potential for structural remodeling. For comprehensive stroke prevention, the <a href="#chadsvascSection">CHADSVASC Calculator</a> is an essential tool.
    </p>
    <p>
      <strong>Atrial Flutter:</strong> Is characterized by a regular “saw-tooth” pattern on ECG due to macroreentrant circuits in the right atrium. Its management can include rate control, cardioversion, and ablation.
    </p>
    <p>
      <strong>Ventricular Tachycardia (VT) & Ventricular Fibrillation (VF):</strong> VT often results from reentrant circuits within scarred myocardium (post‐MI, cardiomyopathy) and can degenerate into VF—a chaotic arrhythmia requiring immediate defibrillation. Advanced management may include antiarrhythmic drugs (e.g., amiodarone, lidocaine), ICD placement, and in selected cases, catheter ablation.
    </p>
  </section>

  <!-- SECTION: ECG Examples -->
  <section id="ecgSection" class="section">
    <h2>ECG Examples</h2>
    
    <h3>Sinus Bradycardia</h3>
    <p>
      A characteristic regular rhythm with visible P waves preceding each QRS complex at a rate below 60 bpm.
    </p>
    <!-- Actual ECG image for Sinus Bradycardia -->
    <div class="diagram">
      <img src="https://www.researchgate.net/profile/Andrew-McNulty-2/publication/231215604/figure/fig2/AS:340083601361920@1451465891143/Representative-ECGs-of-various-arrhythmias-A-sinus-bradycardia-at-a-heart-rate-of-51.jpg" alt="Sinus Bradycardia ECG" width="300">
      <p>ECG: Sinus Bradycardia</p>
    </div>
    
    <h3>Atrial Fibrillation (AFib)</h3>
    <p>
      AFib is diagnosed when there is an irregularly irregular rhythm with no distinct P waves. Noticeable electrical and structural remodeling is common in persistent forms.
    </p>
    <!-- Actual ECG image for Atrial Fibrillation -->
    <div class="diagram">
      <img src="https://ar.inspiredpencil.com/pictures-2023/atrial-fibrillation-ecg" alt="Atrial Fibrillation ECG" width="300">
      <p>ECG: Atrial Fibrillation Example</p>
    </div>
    
    <h3>Atrial Flutter</h3>
    <p>
      Atrial flutter typically displays a saw-tooth pattern, usually with a fixed conduction ratio (often 2:1), resulting in a regular ventricular response.
    </p>
    <!-- Placeholder for an actual Atrial Flutter ECG -->
    <div class="diagram">
      <img src="https://via.placeholder.com/300x150?text=Atrial+Flutter+ECG" alt="Atrial Flutter ECG" width="300">
      <p>ECG: Atrial Flutter Example</p>
    </div>
    
    <h3>Ventricular Tachycardia (VT)/Fibrillation (VF)</h3>
    <p>
      VT is identified by wide QRS complexes (>120 ms) and rapid rate. VF exhibits chaotic, disorganized waves and requires immediate defibrillation.
    </p>
    <!-- Actual ECG image for VT/VF (example provided) -->
    <div class="diagram">
      <img src="https://ar.inspiredpencil.com/pictures-2023/ventricular-fibrillation-vs-ventricular-tachycardia-ecg" alt="Ventricular Tachycardia/VF ECG" width="300">
      <p>ECG: VT/VF Example</p>
    </div>
    
  </section>

  <!-- SECTION: Interactive MCQs -->
  <section id="mcqSection" class="section">
    <h2>Interactive MCQs</h2>
    <div id="mcqContainer"></div>
  </section>

  <!-- SECTION: Interactive ACLS Algorithm -->
  <section id="algoSection" class="section">
    <h2>Interactive ACLS Algorithm</h2>
    <p>
      Follow the branching algorithm based on your patient’s presentation. Make decisions to see tailored management recommendations.
    </p>
    <div id="algoContainer" class="algo-branch">
      <p id="algoText">Step 1: Assess ABCs. Is the patient hemodynamically stable?</p>
      <div id="algoOptions">
        <button onclick="chooseAlgo('stable')">Yes, stable</button>
        <button onclick="chooseAlgo('unstable')">No, unstable</button>
      </div>
    </div>
    <!-- Final complete algorithm image (placeholder) -->
    <div id="fullAlgo" class="algo-diagram" style="display:none;">
      <img src="https://via.placeholder.com/500x300?text=Complete+ACLS+Algorithm+Flowchart" alt="Complete ACLS Algorithm Flowchart">
      <p>Complete ACLS Algorithm Flowchart</p>
      <button onclick="restartAlgo()">Restart Algorithm</button>
    </div>
  </section>

  <!-- SECTION: CHADSVASC Calculator -->
  <section id="chadsvascSection" class="section">
    <h2>Interactive CHADSVASC Calculator</h2>
    <p>
      Use this calculator to determine stroke risk in AFib. Input key patient parameters below and click “Calculate Score.” An explanation of each component will follow.
    </p>
    <div class="chadsvasc-box">
      <form id="chadsvascForm">
        <label>
          Congestive Heart Failure (CHF): 
          <select id="chf">
            <option value="0">No</option>
            <option value="1">Yes</option>
          </select>
        </label>
        <br>
        <label>
          Hypertension:
          <select id="hypertension">
            <option value="0">No</option>
            <option value="1">Yes</option>
          </select>
        </label>
        <br>
        <label>
          Age: 
          <input type="number" id="age" min="0" value="0">
        </label>
        <br>
        <label>
          Diabetes Mellitus:
          <select id="diabetes">
            <option value="0">No</option>
            <option value="1">Yes</option>
          </select>
        </label>
        <br>
        <label>
          Stroke/TIA/Thromboembolism:
          <select id="stroke">
            <option value="0">No</option>
            <option value="2">Yes</option>
          </select>
        </label>
        <br>
        <label>
          Vascular Disease (e.g., MI, PAD, aortic plaque):
          <select id="vascular">
            <option value="0">No</option>
            <option value="1">Yes</option>
          </select>
        </label>
        <br>
        <label>
          Sex:
          <select id="sex">
            <option value="0">Male</option>
            <option value="1">Female</option>
          </select>
        </label>
        <br><br>
        <button type="button" onclick="calculateChadsvasc()">Calculate Score</button>
      </form>
      <div id="chadsvascResult" style="margin-top: 15px; font-weight: bold;"></div>
      <div id="chadsvascExplanation" style="margin-top: 10px;"></div>
    </div>
  </section>

  <!-- SECTION: References -->
  <section id="refSection" class="section">
    <h2>References & Resources</h2>
    <ul>
      <li><a href="https://www.ahajournals.org/" target="_blank">American Heart Association</a> — ACLS Guidelines and Cardiovascular Resources</li>
      <li><a href="https://www.escardio.org/" target="_blank">European Society of Cardiology</a> — In-depth details on AFib and arrhythmia management</li>
      <li><a href="https://www.nice.org.uk/guidance" target="_blank">NICE Guidelines</a> — Standardized clinical guidelines</li>
      <li><a href="https://www.mdcalc.com/calc/801/cha2ds2-vasc-score-atrial-fibrillation-stroke-risk" target="_blank">MDCalc: CHA₂DS₂-VASc Score</a> — Risk stratification tool</li>
      <li><a href="https://www.mksap.com/" target="_blank">MKSAP Review for Internal Medicine</a> — Educational material reference</li>
    </ul>
  </section>

  <!-- JavaScript for Navigation, Theme Toggle, MCQs, Algorithm and CHADSVASC Calculator -->
  <script>
    // Navigation: Simple SPA section toggling
    const navLinks = document.querySelectorAll("#navbar a");
    const sections = document.querySelectorAll(".section");
    navLinks.forEach(link => {
      link.addEventListener("click", function() {
        sections.forEach(sec => sec.classList.remove("active"));
        document.getElementById(this.getAttribute("data-target")).classList.add("active");
      });
    });

    // Theme Toggle
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-theme');
      document.body.classList.toggle('light-theme');
    });

    // Interactive MCQs
    const mcqData = [
      {
        question: "Which feature is most indicative of advanced sinus node dysfunction?",
        options: [
          "A heart rate of 55 bpm in a young athlete",
          "Marked bradycardia with chronotropic incompetence and symptoms of fatigue/syncope",
          "Occasional premature atrial contractions",
          "Regular rhythm with a slightly prolonged PR interval"
        ],
        answer: 1,
        explanation: "Advanced sinus node dysfunction often presents with marked bradycardia, an inability to appropriately increase the rate during activity (chronotropic incompetence), and associated symptoms."
      },
      {
        question: "In Mobitz II second-degree AV block, which finding is most concerning?",
        options: [
          "Progressive PR prolongation before a dropped beat",
          "Fixed PR intervals with occasional non-conducted P waves, indicating conduction system disease",
          "A normal PR interval with isolated dropped beats",
          "Short PR interval suggestive of pre-excitation syndrome"
        ],
        answer: 1,
        explanation: "Mobitz II is worrisome because it features fixed PR intervals with sudden dropped beats, indicating significant conduction system pathology that can progress to complete heart block."
      }
      // Additional advanced MCQs can be appended here.
    ];
    
    const mcqContainer = document.getElementById('mcqContainer');
    mcqData.forEach((mcq, index) => {
      const div = document.createElement('div');
      div.className = 'mcq';
      
      const q = document.createElement('p');
      q.innerText = (index + 1) + ". " + mcq.question;
      div.appendChild(q);
      
      mcq.options.forEach((option, idx) => {
        const label = document.createElement('label');
        label.style.display = 'block';
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = 'mcq' + index;
        radio.value = idx;
        label.appendChild(radio);
        label.append(" " + option);
        div.appendChild(label);
      });
      
      const result = document.createElement('p');
      result.id = 'result' + index;
      result.style.fontStyle = 'italic';
      div.appendChild(result);
      
      const checkBtn = document.createElement('button');
      checkBtn.innerText = 'Check Answer';
      checkBtn.addEventListener('click', () => {
        const radios = document.getElementsByName('mcq' + index);
        let selected;
        for (const r of radios) {
          if (r.checked) {
            selected = parseInt(r.value);
            break;
          }
        }
        if (selected === undefined) {
          result.innerText = "Please select an answer.";
          return;
        }
        if (selected === mcq.answer) {
          result.innerText = "Correct! " + mcq.explanation;
          result.style.color = "green";
        } else {
          result.innerText = "Incorrect. " + mcq.explanation;
          result.style.color = "red";
        }
      });
      div.appendChild(checkBtn);
      
      mcqContainer.appendChild(div);
    });
    
    // Interactive Algorithm logic (branching)
    let algoState = "start";
    function chooseAlgo(option) {
      const algoText = document.getElementById("algoText");
      const algoOptions = document.getElementById("algoOptions");
      
      if (algoState === "start") {
        if(option === "unstable"){
          algoText.innerText = "Since the patient is unstable, immediate resuscitative measures are required. For VT/VF, immediate defibrillation is indicated (unsynchronized shock). This branch ends here. Restart to review again.";
          algoOptions.innerHTML = '<button onclick="restartAlgo()">Restart Algorithm</button>';
          algoState = "ended";
        } else {
          algoText.innerText = "Patient is stable. Is the arrhythmia AFib?";
          algoOptions.innerHTML = '<button onclick="chooseAlgo(\'isAFib\')">Yes, AFib</button> <button onclick="chooseAlgo(\'other\')">No, other arrhythmia</button>';
          algoState = "stable";
        }
      } else if (algoState === "stable") {
        if(option === "isAFib"){
          algoText.innerText = "For stable AFib, choose between <em>rate control</em> and <em>rhythm control</em> strategies. Note that structural remodeling and stroke risk (evaluate via CHA₂DS₂-VASc) will guide therapy.";
          algoOptions.innerHTML = '<button onclick="finishAlgo()">Finish</button>';
          algoState = "afib";
        } else {
          algoText.innerText = "For other stable arrhythmias (e.g., SVT), initial management includes vagal maneuvers. If ineffective, proceed with adenosine or consider advanced diagnostics.";
          algoOptions.innerHTML = '<button onclick="finishAlgo()">Finish</button>';
          algoState = "nonAfib";
        }
      }
    }
    
    function finishAlgo() {
      document.getElementById("algoContainer").style.display = "none";
      document.getElementById("fullAlgo").style.display = "block";
    }
    
    function restartAlgo() {
      algoState = "start";
      document.getElementById("algoContainer").style.display = "block";
      document.getElementById("fullAlgo").style.display = "none";
      document.getElementById("algoText").innerText = "Step 1: Assess ABCs. Is the patient hemodynamically stable?";
      document.getElementById("algoOptions").innerHTML = '<button onclick="chooseAlgo(\'stable\')">Yes, stable</button><button onclick="chooseAlgo(\'unstable\')">No, unstable</button>';
    }
    
    // CHADSVASC Calculator
    function calculateChadsvasc() {
      // Retrieve values and convert to numbers
      const chf = parseInt(document.getElementById('chf').value);
      const hypertension = parseInt(document.getElementById('hypertension').value);
      const age = parseInt(document.getElementById('age').value);
      const diabetes = parseInt(document.getElementById('diabetes').value);
      const stroke = parseInt(document.getElementById('stroke').value);
      const vascular = parseInt(document.getElementById('vascular').value);
      const sex = parseInt(document.getElementById('sex').value);
      
      let score = chf + hypertension + diabetes + stroke + vascular + sex;
      
      // Age scoring: Age ≥75 = 2; Age 65-74 = 1; otherwise 0
      if (age >= 75) {
        score += 2;
      } else if (age >= 65) {
        score += 1;
      }
      
      // Display the score and explanation
      const resultDiv = document.getElementById('chadsvascResult');
      resultDiv.innerText = "Your CHADSVASC score is: " + score;
      
      let explanation = "";
      if (score === 0) {
        explanation = "Very low risk for stroke – no antithrombotic therapy is needed.";
      } else if ((score === 1 && sex === 0) || (score === 2 && sex === 1)) {
        explanation = "Low risk – consider patient-specific factors when deciding on anticoagulation.";
      } else {
        explanation = "Moderate-to-high risk for stroke – anticoagulation is generally recommended.";
      }
      document.getElementById('chadsvascExplanation').innerText = explanation;
    }
  </script>
</body>
</html>
