<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Advanced Arrhythmia Module for PGY-1</title>
  <style>
    /* Global styles and transitions */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
      transition: background-color 0.3s, color 0.3s;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 10px;
      border-bottom: 2px solid #ccc;
      margin-bottom: 20px;
    }
    /* Top Navigation */
    #navbar {
      margin-bottom: 20px;
      background: #f0f0f0;
      padding: 10px 15px;
      border-radius: 5px;
      display: flex;
      gap: 15px;
    }
    #navbar a {
      text-decoration: none;
      font-weight: bold;
      padding: 8px 12px;
      border-radius: 4px;
      color: inherit;
      transition: background 0.2s;
    }
    #navbar a:hover,
    #navbar a.active {
      background: #2a5d84;
      color: #fff;
    }
    /* Section styles */
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }
    /* Sub-tab navigation for arrhythmia types */
    .subnav {
      margin: 15px 0;
      display: flex;
      gap: 10px;
      border-bottom: 2px solid #ddd;
      padding-bottom: 5px;
    }
    .subnav a {
      text-decoration: none;
      font-weight: bold;
      padding: 6px 10px;
      border-radius: 4px;
      color: inherit;
      transition: background 0.2s;
    }
    .subnav a:hover,
    .subnav a.active {
      background: #2a5d84;
      color: #fff;
    }
    /* Boxes for placeholder diagrams */
    .diagram, .algo-diagram, .placeholder {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px 0;
      text-align: center;
      border-radius: 4px;
    }
    /* Styling interactive elements */
    .mcq, .algo-branch, .chadsvasc-box {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #f9f9f9;
    }
    button {
      padding: 6px 10px;
      margin: 5px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background: #2a5d84;
      color: #fff;
      transition: background 0.2s;
    }
    button:hover {
      background: #1d3e65;
    }
    input[type="number"] {
      width: 60px;
    }
    /* Dark theme styles */
    .dark-theme {
      background-color: #222;
      color: #f0f0f0;
    }
    .dark-theme #navbar {
      background: #333;
    }
    .dark-theme #navbar a {
      color: #f0f0f0;
    }
    .dark-theme .mcq,
    .dark-theme .algo-branch,
    .dark-theme .chadsvasc-box {
      background: #333;
      border: 1px solid #444;
    }
    .dark-theme .subnav {
      border-bottom: 2px solid #555;
    }
  </style>
</head>
<body class="light-theme">
  <!-- Header with Navigation and Theme Toggle -->
  <header>
    <h1>Advanced Arrhythmia Module for PGY-1</h1>
    <button id="themeToggle">Toggle Dark/Light Theme</button>
  </header>
  
  <!-- Top Navigation Tabs -->
  <nav id="navbar">
    <a data-target="handoutSection" class="active">Handout</a>
    <a data-target="ecgSection">ECG Examples</a>
    <a data-target="mcqSection">Interactive MCQs</a>
    <a data-target="algoSection">Interactive Algorithm</a>
    <a data-target="chadsvascSection">CHADSVASC Calculator</a>
    <a data-target="refSection">References</a>
  </nav>

  <!-- SECTION: Handout with Sub-Tabs for Arrhythmia Types -->
  <section id="handoutSection" class="section active">
    <h2>Advanced Arrhythmia Handout</h2>
    <p>
      Arrhythmia describes any deviation from normal cardiac rhythm or rate. In this module, we review advanced clinical details, including pathophysiology, evaluation, and management.
    </p>
    <h3>Normal Cardiac Conduction</h3>
    <p>
      The conduction system encompasses the <strong>Sinoatrial (SA) Node</strong> – the natural pacemaker; the <strong>Atrioventricular (AV) Node</strong> – which delays impulses for coordinated atrial and ventricular contraction; and the <strong>His-Purkinje network</strong>, ensuring rapid ventricular conduction.
    </p>
    <div class="diagram">
      <p>Diagram: Normal Cardiac Conduction (SVG placeholder)</p>
    </div>
    
    <!-- Sub-tabs for Arrhythmia Categories -->
    <div class="subnav">
      <a data-target="bradyTab" class="active">Bradyarrhythmias</a>
      <a data-target="tachyTab">Tachyarrhythmias</a>
    </div>
    
    <!-- Sub-Tab Content: Bradyarrhythmias -->
    <div id="bradyTab" class="subtab active">
      <h3>Bradyarrhythmias</h3>
      <h4>Sinus Bradycardia</h4>
      <p>
        Sinus bradycardia is defined by a heart rate less than 60 bpm with normal P‑wave morphology. Beyond a physiologic finding in athletes, advanced evaluation might reveal sick sinus syndrome or drug effects. Treatment is indicated for symptomatic patients and may involve cessation of negative chronotropes or pacing.
      </p>
      <h4>Heart Blocks</h4>
      <p>
        <strong>First-Degree AV Block:</strong> Prolonged PR interval (>200 ms) with all impulses conducted. Often benign but may be a harbinger of further conduction system disease.
      </p>
      <p>
        <strong>Second-Degree AV Block:</strong> 
        <br>• <em>Mobitz I (Wenckebach):</em> Progressive PR prolongation leading to a dropped beat (commonly vagal-mediated).
        <br>• <em>Mobitz II:</em> Fixed PR intervals with intermittent non-conducted P waves, indicating a significant conduction disorder which may progress to complete block.
      </p>
      <p>
        <strong>Third-Degree AV Block:</strong> Complete AV dissociation—an emergent condition usually requiring permanent pacemaker implantation.
      </p>
    </div>
    
    <!-- Sub-Tab Content: Tachyarrhythmias -->
    <div id="tachyTab" class="subtab" style="display:none;">
      <h3>Tachyarrhythmias</h3>
      <h4>Supraventricular Tachycardia (SVT)</h4>
      <p>
        SVT (including AVNRT and AVRT) is characterized by a rapid, usually narrow QRS complex tachycardia. Advanced electrophysiology (EP) studies often delineate reentrant circuits. First-line management includes vagal maneuvers and adenosine.
      </p>
      <h4>Atrial Fibrillation (AFib)</h4>
      <p>
        AFib is recognized by an irregularly irregular rhythm and the absence of distinct P waves. Its pathophysiology implicates focal triggers, structural remodeling, and fibrosis. Subtypes include paroxysmal, persistent, and permanent AFib (including those with rapid ventricular response or controlled rate). For stroke prevention, use the <a data-target="chadsvascSection" style="text-decoration: underline; cursor: pointer;">CHADSVASC Calculator</a>.
      </p>
      <h4>Atrial Flutter</h4>
      <p>
        Atrial flutter manifests as a “saw-tooth” pattern secondary to large macroreentrant circuits within the atria. Fixed conduction ratios (commonly 2:1) may yield a regular ventricular rhythm. Management may involve rate control, electrical cardioversion, or catheter ablation.
      </p>
      <h4>Ventricular Tachycardia (VT) & Ventricular Fibrillation (VF)</h4>
      <p>
        VT is characterized by wide QRS complexes (>120 ms) and frequently arises in the setting of scarred myocardium (post–MI, cardiomyopathy). VT may degenerate into VF—an immediately life-threatening state requiring emergent defibrillation. Advanced management may necessitate antiarrhythmic therapy, ICD implantation, or catheter ablation.
      </p>
    </div>
  </section>

  <!-- SECTION: ECG Examples (Without Stock Images) -->
  <section id="ecgSection" class="section">
    <h2>ECG Examples</h2>
    <p>
      In a clinical module, you’d review actual ECG strips. Here, textual placeholders indicate what you would expect:
    </p>
    <div class="placeholder">
      <p><strong>Sinus Bradycardia:</strong> Regular rhythm, clear P waves, rate below 60 bpm.</p>
    </div>
    <div class="placeholder">
      <p><strong>Atrial Fibrillation:</strong> Irregular rhythm with absent P waves.</p>
    </div>
    <div class="placeholder">
      <p><strong>Atrial Flutter:</strong> "Saw-tooth" pattern with regular ventricular response (e.g., 2:1 conduction).</p>
    </div>
    <div class="placeholder">
      <p><strong>VT/VF:</strong> VT shows wide QRS complexes; VF appears chaotic without discernible QRS complexes.</p>
    </div>
  </section>

  <!-- SECTION: Interactive MCQs -->
  <section id="mcqSection" class="section">
    <h2>Interactive MCQs</h2>
    <div id="mcqContainer"></div>
  </section>

  <!-- SECTION: Interactive Algorithm -->
  <section id="algoSection" class="section">
    <h2>Interactive ACLS Algorithm</h2>
    <p>
      Follow the branching algorithm below based on your patient’s presentation. Make decisions to see tailored management recommendations.
    </p>
    <div id="algoContainer" class="algo-branch">
      <p id="algoText">Step 1: Assess ABCs. Is the patient hemodynamically stable?</p>
      <div id="algoOptions">
        <button onclick="chooseAlgo('stable')">Yes, stable</button>
        <button onclick="chooseAlgo('unstable')">No, unstable</button>
      </div>
    </div>
    <div id="fullAlgo" class="algo-diagram" style="display:none;">
      <p>Complete ACLS Algorithm Flowchart (Placeholder)</p>
      <button onclick="restartAlgo()">Restart Algorithm</button>
    </div>
  </section>

  <!-- SECTION: CHADSVASC Calculator -->
  <section id="chadsvascSection" class="section">
    <h2>Interactive CHADSVASC Calculator</h2>
    <p>
      Use this calculator to determine stroke risk in AFib. Input key patient parameters below and click “Calculate Score.”
    </p>
    <div class="chadsvasc-box">
      <form id="chadsvascForm">
        <label>
          Congestive Heart Failure (CHF): 
          <select id="chf">
            <option value="0">No</option>
            <option value="1">Yes</option>
          </select>
        </label>
        <br>
        <label>
          Hypertension:
          <select id="hypertension">
            <option value="0">No</option>
            <option value="1">Yes</option>
          </select>
        </label>
        <br>
        <label>
          Age: 
          <input type="number" id="age" min="0" value="0">
        </label>
        <br>
        <label>
          Diabetes Mellitus:
          <select id="diabetes">
            <option value="0">No</option>
            <option value="1">Yes</option>
          </select>
        </label>
        <br>
        <label>
          Stroke/TIA/Thromboembolism:
          <select id="stroke">
            <option value="0">No</option>
            <option value="2">Yes</option>
          </select>
        </label>
        <br>
        <label>
          Vascular Disease (e.g., MI, PAD, aortic plaque):
          <select id="vascular">
            <option value="0">No</option>
            <option value="1">Yes</option>
          </select>
        </label>
        <br>
        <label>
          Sex:
          <select id="sex">
            <option value="0">Male</option>
            <option value="1">Female</option>
          </select>
        </label>
        <br><br>
        <button type="button" onclick="calculateChadsvasc()">Calculate Score</button>
      </form>
      <div id="chadsvascResult" style="margin-top: 15px; font-weight: bold;"></div>
      <div id="chadsvascExplanation" style="margin-top: 10px;"></div>
    </div>
  </section>

  <!-- SECTION: References -->
  <section id="refSection" class="section">
    <h2>References & Resources</h2>
    <ul>
      <li><a href="https://www.ahajournals.org/" target="_blank">American Heart Association</a> — ACLS Guidelines and Cardiovascular Resources</li>
      <li><a href="https://www.escardio.org/" target="_blank">European Society of Cardiology</a> — In-depth details on AFib and arrhythmia management</li>
      <li><a href="https://www.nice.org.uk/guidance" target="_blank">NICE Guidelines</a> — Standardized clinical guidelines</li>
      <li><a href="https://www.mdcalc.com/calc/801/cha2ds2-vasc-score-atrial-fibrillation-stroke-risk" target="_blank">MDCalc: CHA₂DS₂-VASc Score</a> — Risk stratification tool</li>
      <li><a href="https://www.mksap.com/" target="_blank">MKSAP Review for Internal Medicine</a> — Educational material reference</li>
    </ul>
  </section>
  
  <!-- JavaScript for Navigation, Theme Toggle, MCQs, Algorithm, and CHADSVASC Calculator -->
  <script>
    /* Top-Level Navigation */
    const navLinks = document.querySelectorAll("#navbar a");
    const sections = document.querySelectorAll(".section");
    navLinks.forEach(link => {
      link.addEventListener("click", function() {
        navLinks.forEach(n => n.classList.remove("active"));
        this.classList.add("active");
        sections.forEach(sec => sec.classList.remove("active"));
        document.getElementById(this.getAttribute("data-target")).classList.add("active");
      });
    });
    
    /* Theme Toggle */
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-theme');
      document.body.classList.toggle('light-theme');
    });
    
    /* Sub-Tab Navigation for Handout */
    const subTabs = document.querySelectorAll(".subnav a");
    const subTabContents = document.querySelectorAll(".subtab");
    subTabs.forEach(tab => {
      tab.addEventListener("click", function() {
        subTabs.forEach(t => t.classList.remove("active"));
        this.classList.add("active");
        subTabContents.forEach(content => content.style.display = "none");
        document.getElementById(this.getAttribute("data-target")).style.display = "block";
      });
    });
    
    /* Interactive MCQs */
    const mcqData = [
      {
        question: "Which feature is most indicative of advanced sinus node dysfunction?",
        options: [
          "A heart rate of 55 bpm in a young athlete",
          "Marked bradycardia with chronotropic incompetence and symptoms of fatigue/syncope",
          "Occasional premature atrial contractions",
          "Regular rhythm with a slightly prolonged PR interval"
        ],
        answer: 1,
        explanation: "Advanced sinus node dysfunction typically presents with marked bradycardia, an impaired ability to increase the heart rate during exercise (chronotropic incompetence), and associated symptoms."
      },
      {
        question: "In Mobitz II second-degree AV block, which finding is most concerning?",
        options: [
          "Progressive PR prolongation before a dropped beat",
          "Fixed PR intervals with intermittent non-conducted P waves, indicating significant conduction system disease",
          "A normal PR interval with isolated dropped beats",
          "Short PR interval suggestive of pre-excitation syndrome"
        ],
        answer: 1,
        explanation: "Mobitz II block is concerning because the fixed PR intervals with sudden dropped beats indicate an advanced conduction defect that may progress to third-degree block."
      }
    ];
    
    const mcqContainer = document.getElementById('mcqContainer');
    mcqData.forEach((mcq, index) => {
      const div = document.createElement('div');
      div.className = 'mcq';
      
      const q = document.createElement('p');
      q.innerText = (index + 1) + ". " + mcq.question;
      div.appendChild(q);
      
      mcq.options.forEach((option, idx) => {
        const label = document.createElement('label');
        label.style.display = 'block';
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = 'mcq' + index;
        radio.value = idx;
        label.appendChild(radio);
        label.append(" " + option);
        div.appendChild(label);
      });
      
      const result = document.createElement('p');
      result.id = 'result' + index;
      result.style.fontStyle = 'italic';
      div.appendChild(result);
      
      const checkBtn = document.createElement('button');
      checkBtn.innerText = 'Check Answer';
      checkBtn.addEventListener('click', () => {
        const radios = document.getElementsByName('mcq' + index);
        let selected;
        for (const r of radios) {
          if (r.checked) {
            selected = parseInt(r.value);
            break;
          }
        }
        if (selected === undefined) {
          result.innerText = "Please select an answer.";
          return;
        }
        if (selected === mcq.answer) {
          result.innerText = "Correct! " + mcq.explanation;
          result.style.color = "green";
        } else {
          result.innerText = "Incorrect. " + mcq.explanation;
          result.style.color = "red";
        }
      });
      div.appendChild(checkBtn);
      mcqContainer.appendChild(div);
    });
    
    /* Interactive ACLS Algorithm */
    /* New Interactive ACLS Algorithm Code */
let algoState = "start";
function chooseAlgo(option) {
  const algoText = document.getElementById("algoText");
  const algoOptions = document.getElementById("algoOptions");
  
  switch(algoState) {
    case "start":
      if (option === "unstable") {
        algoText.innerText = "Patient is unstable – immediate resuscitation is imperative. For VT/VF, administer immediate defibrillation (unsynchronized shock). This branch ends here.";
        algoOptions.innerHTML = '<button onclick="restartAlgo()">Restart Algorithm</button>';
        algoState = "ended";
      } else if (option === "stable") {
        algoText.innerText = "Patient is stable. Is the arrhythmia atrial fibrillation (AFib)?";
        algoOptions.innerHTML = '<button onclick="chooseAlgo(\'isAFib\')">Yes, AFib</button> <button onclick="chooseAlgo(\'other\')">No, other arrhythmia</button>';
        algoState = "stable";
      }
      break;
      
    case "stable":
      if (option === "isAFib") {
        algoText.innerText = "For stable AFib, please choose the management strategy:\n\nDo you prefer Rate Control or Rhythm Control?";
        algoOptions.innerHTML = '<button onclick="chooseAlgo(\'rateControl\')">Rate Control</button> <button onclick="chooseAlgo(\'rhythmControl\')">Rhythm Control</button>';
        algoState = "afibDecision";
      } else if (option === "other") {
        algoText.innerText = "For other stable tachyarrhythmias (e.g., SVT), initial management includes vagal maneuvers. If they are ineffective, consider adenosine or further evaluation.";
        algoOptions.innerHTML = '<button onclick="finishAlgo()">Finish</button>';
        algoState = "nonAfib";
      }
      break;
      
    case "afibDecision":
      if (option === "rateControl") {
        algoText.innerText = "Rate Control: For stable AFib, agents such as beta blockers or calcium channel blockers are generally used to regulate the ventricular rate. Monitor the patient for adequate rate control and adjust medications as needed.";
        algoOptions.innerHTML = '<button onclick="finishAlgo()">Finish</button>';
        algoState = "afibRate";
      } else if (option === "rhythmControl") {
        algoText.innerText = "Rhythm Control: In selected patients with stable AFib (typically those with significant symptoms or younger candidates), consider antiarrhythmic drugs or electrical cardioversion. Also, assess for underlying structural heart disease.";
        algoOptions.innerHTML = '<button onclick="finishAlgo()">Finish</button>';
        algoState = "afibRhythm";
      }
      break;
      
    default:
      console.log("Unexpected state reached in algorithm");
  }
}

function finishAlgo() {
  document.getElementById("algoContainer").style.display = "none";
  document.getElementById("fullAlgo").style.display = "block";
}

function restartAlgo() {
  algoState = "start";
  document.getElementById("algoContainer").style.display = "block";
  document.getElementById("fullAlgo").style.display = "none";
  document.getElementById("algoText").innerText = "Step 1: Assess ABCs. Is the patient hemodynamically stable?";
  document.getElementById("algoOptions").innerHTML = '<button onclick="chooseAlgo(\'stable\')">Yes, stable</button><button onclick="chooseAlgo(\'unstable\')">No, unstable</button>';
}

    
    /* CHADSVASC Calculator */
    function calculateChadsvasc() {
      const chf = parseInt(document.getElementById('chf').value);
      const hypertension = parseInt(document.getElementById('hypertension').value);
      const age = parseInt(document.getElementById('age').value);
      const diabetes = parseInt(document.getElementById('diabetes').value);
      const stroke = parseInt(document.getElementById('stroke').value);
      const vascular = parseInt(document.getElementById('vascular').value);
      const sex = parseInt(document.getElementById('sex').value);
      
      let score = chf + hypertension + diabetes + stroke + vascular + sex;
      
      if (age >= 75) {
        score += 2;
      } else if (age >= 65) {
        score += 1;
      }
      
      const resultDiv = document.getElementById('chadsvascResult');
      resultDiv.innerText = "Your CHADSVASC score is: " + score;
      
      let explanation = "";
      if (score === 0) {
        explanation = "Very low risk for stroke – no antithrombotic therapy is needed.";
      } else if ((score === 1 && sex === 0) || (score === 2 && sex === 1)) {
        explanation = "Low risk – patient-specific factors should guide the decision on anticoagulation.";
      } else {
        explanation = "Moderate-to-high risk for stroke – anticoagulation is generally recommended.";
      }
      document.getElementById('chadsvascExplanation').innerText = explanation;
    }
  </script>
</body>
</html>
